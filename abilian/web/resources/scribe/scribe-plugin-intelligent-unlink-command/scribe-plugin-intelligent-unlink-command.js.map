{"version":3,"file":"scribe-plugin-intelligent-unlink-command.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["../src/scribe-plugin-intelligent-unlink-command.js"],"sourcesContent":["define('scribe-plugin-intelligent-unlink-command',[], function () {\n\n  /**\n   * This plugin modifies the `unlink` command so that, when the user's\n   * selection is collapsed, remove the containing A.\n   */\n\n  'use strict';\n\n  return function () {\n    return function (scribe) {\n      var element = scribe.element;\n      \n      var unlinkCommand = new scribe.api.Command('unlink');\n\n      unlinkCommand.execute = function () {\n        var selection = new scribe.api.Selection();\n\n        if (selection.selection.isCollapsed) {\n          scribe.transactionManager.run(function () {\n            /**\n             * If the selection is collapsed, we can remove the containing anchor.\n             */\n\n            var aNode = selection.getContaining(function (node) {\n              return node.nodeName === 'A';\n            });\n\n            if (aNode) {\n              // we must save and then restore the selection because unwrapping\n              // the anchor loses the current selection\n              selection.placeMarkers();\n\n              // unwrap the A element's children, then remove it\n              element.unwrap(aNode.parentNode, aNode);\n\n              // finally restore selection to the initial position\n              selection.selectMarkers();\n            }\n          });\n        } else {\n          scribe.api.Command.prototype.execute.apply(this, arguments);\n        }\n      };\n\n      unlinkCommand.queryEnabled = function () {\n        var selection = new scribe.api.Selection();\n        if (selection.selection.isCollapsed) {\n          return !! selection.getContaining(function (node) {\n            return node.nodeName === 'A';\n          });\n        } else {\n          return scribe.api.Command.prototype.queryEnabled.apply(this, arguments);\n        }\n      };\n\n      scribe.commands.unlink = unlinkCommand;\n    };\n  };\n\n});\n\n"],"names":[]}
{"version":3,"file":"scribe-plugin-smart-lists.js","mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","sources":["../src/scribe-plugin-smart-lists.js"],"sourcesContent":["define('scribe-plugin-smart-lists',[], function () {\n\n  'use strict';\n\n  return function () {\n\n    var keys = {\n      32: 'Space',\n      42: '*',\n      45: '-',\n      46: '.',\n      49: '1',\n      // Bullet insertion keycode, most likely only working on OS X...\n      8226:  '•'\n    };\n\n    function isUnorderedListChar(string) {\n      return string === '*' || string === '-' || string === '•';\n    }\n\n    return function (scribe) {\n\n      var preLastChar, lastChar, currentChar;\n\n      function findBlockContainer(node) {\n        while (node && ! scribe.element.isBlockElement(node)) {\n          node = node.parentNode;\n        }\n\n        return node;\n      }\n\n      function removeSelectedTextNode() {\n        var selection = new scribe.api.Selection();\n        var container = selection.selection.anchorNode;\n        /**\n         * Firefox: Selection object never gets access to text nodes, only\n         * parent elements.\n         * As per: http://jsbin.com/rotus/2/edit?js,output,console\n         * Bugzilla: https://bugzilla.mozilla.org/show_bug.cgi?id=1042701\n         */\n        var textNode;\n        if (container.nodeType === Node.TEXT_NODE) {\n          textNode = container;\n        } else if (container.firstChild.nodeType === Node.TEXT_NODE) {\n          textNode = container.firstChild;\n        }\n\n        if (textNode) {\n          var parentNode = textNode.parentNode;\n          /**\n           * Firefox: Given text of \"1.\", we sometimes have two text nodes\n           * (why?): \"1\" and \".\"\n           */\n          if (textNode.previousSibling) {\n            parentNode.removeChild(textNode.previousSibling);\n          }\n          parentNode.removeChild(textNode);\n        } else {\n          throw new Error('Cannot empty non-text node!');\n        }\n      }\n\n      function input(event) {\n        var listCommand;\n\n        preLastChar = lastChar;\n        lastChar = currentChar;\n        // FIXME: Chrome / FF, theoretically we should be using event.key?\n        //        can we abstract this madness?\n        currentChar = keys[event.charCode];\n\n        var selection = new scribe.api.Selection();\n\n        // TODO: if a <p> with just this content\n        var container = selection.range.commonAncestorContainer;\n\n        // If in a <p>\n        var blockContainer = findBlockContainer(container);\n        if (blockContainer && blockContainer.tagName === 'P') {\n          // Warning: There is no guarantee that `container` will be a text node\n          // Failing Firefox tests\n\n          var startOfLineIsUList = isUnorderedListChar(container.textContent[0]);\n          var cursorIsInSecondPosition = selection.range.endOffset === 1;\n          if (isUnorderedListChar(lastChar) && currentChar === 'Space' && startOfLineIsUList && cursorIsInSecondPosition) {\n            listCommand = 'insertUnorderedList';\n          }\n\n          /**\n           * Firefox: Selection object never gets access to text nodes, only\n           * parent elements. This means that *sometimes* unordered lists\n           * will not work.\n           * As per: http://jsbin.com/rotus/2/edit?js,output,console\n           * Bugzilla: https://bugzilla.mozilla.org/show_bug.cgi?id=1042701\n           */\n\n          // Some browsers split text nodes randomly, so we can't be sure the\n          // prefix will be contained within a single text node (observed in\n          // Firefox)\n          var startOfLineIsOList = [\n            container.previousSibling && container.previousSibling.textContent,\n            container.textContent\n          ].join('').slice(0, 2) === '1.';\n          if (preLastChar === '1' && lastChar === '.' && currentChar === 'Space' && startOfLineIsOList) {\n            listCommand = 'insertOrderedList';\n          }\n        }\n\n        if (listCommand) {\n          // Ignore the typed character\n          event.preventDefault();\n\n          scribe.transactionManager.run(function() {\n            scribe.getCommand(listCommand).execute();\n\n            // Clear \"* \"/etc from the list item\n            removeSelectedTextNode();\n          });\n        }\n      }\n\n      scribe.el.addEventListener('keypress', input);\n    };\n  };\n\n});\n\n"],"names":[]}
{"version":3,"file":"scribe-plugin-link-prompt-command.min.js","mappings":"AAAA,OAAA,uCAAA,WAQA,MAAA,YACA,MAAA,UAAA,GACA,GAAA,GAAA,GAAA,GAAA,IAAA,QAAA,aAEA,GAAA,SAAA,IAEA,EAAA,QAAA,WACA,GAAA,GAAA,GAAA,GAAA,IAAA,UACA,EAAA,EAAA,MACA,EAAA,EAAA,cAAA,SAAA,GACA,MAAA,GAAA,WAAA,KAAA,UACA,KAAA,OACA,EAAA,EAAA,EAAA,KAAA,UACA,EAAA,OAAA,OAAA,gBAAA,EAWA,IATA,IACA,EAAA,WAAA,GACA,EAAA,UAAA,kBACA,EAAA,UAAA,SAAA,IAMA,EAAA,CAGA,GAAA,GAAA,eAEA,KAAA,EAAA,KAAA,GACA,IAAA,YAAA,KAAA,IAAA,IAAA,KAAA,GAAA,CACA,GAAA,GAAA,OAAA,QACA,wGAGA,KACA,EAAA,UAAA,OAEA,CACA,GAAA,GAAA,OAAA,QACA,8FAGA,KACA,EAAA,UAAA,GAKA,EAAA,IAAA,cAAA,UAAA,QAAA,KAAA,KAAA,KAIA,EAAA,WAAA,WAMA,GAAA,GAAA,GAAA,GAAA,IAAA,SACA,SAAA,EAAA,cAAA,SAAA,GACA,MAAA,GAAA,WAAA,KAAA,UACA,KAAA,QAGA,EAAA,SAAA,WAAA","sources":["../src/scribe-plugin-link-prompt-command.js"],"sourcesContent":["define('scribe-plugin-link-prompt-command',[],function () {\n\n  /**\n   * This plugin adds a command for creating links, including a basic prompt.\n   */\n\n  'use strict';\n\n  return function () {\n    return function (scribe) {\n      var linkPromptCommand = new scribe.api.Command('createLink');\n\n      linkPromptCommand.nodeName = 'A';\n\n      linkPromptCommand.execute = function () {\n        var selection = new scribe.api.Selection();\n        var range = selection.range;\n        var anchorNode = selection.getContaining(function (node) {\n          return node.nodeName === this.nodeName;\n        }.bind(this));\n        var initialLink = anchorNode ? anchorNode.href : 'http://';\n        var link = window.prompt('Enter a link.', initialLink);\n\n        if (anchorNode) {\n          range.selectNode(anchorNode);\n          selection.selection.removeAllRanges();\n          selection.selection.addRange(range);\n        }\n\n        // FIXME: I don't like how plugins like this do so much. Is there a way\n        // to compose?\n\n        if (link) {\n          // Prepend href protocol if missing\n          // For emails we just look for a `@` symbol as it is easier.\n          var urlProtocolRegExp = /^https?\\:\\/\\//;\n          // We don't want to match URLs that sort of look like email addresses\n          if (! urlProtocolRegExp.test(link)) {\n            if (! /^mailto\\:/.test(link) && /@/.test(link)) {\n              var shouldPrefixEmail = window.confirm(\n                'The URL you entered appears to be an email address. ' +\n                'Do you want to add the required “mailto:” prefix?'\n              );\n              if (shouldPrefixEmail) {\n                link = 'mailto:' + link;\n              }\n            } else {\n              var shouldPrefixLink = window.confirm(\n                'The URL you entered appears to be a link. ' +\n                'Do you want to add the required “http://” prefix?'\n              );\n              if (shouldPrefixLink) {\n                link = 'http://' + link;\n              }\n            }\n          }\n\n          scribe.api.SimpleCommand.prototype.execute.call(this, link);\n        }\n      };\n\n      linkPromptCommand.queryState = function () {\n        /**\n         * We override the native `document.queryCommandState` for links because\n         * the `createLink` and `unlink` commands are not supported.\n         * As per: http://jsbin.com/OCiJUZO/1/edit?js,console,output\n         */\n        var selection = new scribe.api.Selection();\n        return !! selection.getContaining(function (node) {\n          return node.nodeName === this.nodeName;\n        }.bind(this));\n      };\n\n      scribe.commands.linkPrompt = linkPromptCommand;\n    };\n  };\n\n});\n\n"],"names":[]}
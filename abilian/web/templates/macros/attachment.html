{% from "macros/user.html" import m_user_photo, m_user_link %}
{% from "macros/form.html" import m_field %}

{% macro m_attachments(entity) %}
  {%- if attachments.has_attachments(entity) %}
    <ul class="attachments">
    {%- for attachment in attachments.for_entity(entity) %}
      <li id="attachment-{{ attachment.id }}">{{ m_attachment(attachment) }}</li>
    {%- endfor %}
    </ul>
  {%- endif %}
{% endmacro %}

{# single attachment #}
{% macro m_attachment(attachment) %}
  <div class="media">
    <div class="media-left">
      <i class="fa fa-file fa-big"></i>
    </div>
    <div class="media-body">
      <h4 class="media-heading">
        <a href="{{ url_for('attachments.download',
                            entity_id=attachment.entity.id,
                            object_id=attachment.id) }}"
           title="{{ _('Download') }}">{{ attachment.name }}</a>
        <small>{{ attachment.blob.size | filesize }}</small>
      </h4>
      <p>{{ attachment.description }}</p>
    </div>
  </div>
{% endmacro %}

{# new attachment form #}
{% macro m_attachment_form(entity) %}
  {%- set ctx = attachments.get_form_context(entity) %}
  <form class="form-inline" action="{{ ctx.url }}" method="POST" enctype="multipart/form-data" role="form">
    {%- for field in ctx.form %}
      {{ m_field(field) }}
    {%- endfor %}

    <div class="form-group form-actions">
      {%- for button in ctx.buttons %}
        {{ button.render() }}
      {%- endfor %}
    </div>
  </form>
{% endmacro %}
